<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GA4 데이터 수집 테스트 페이지</title>
    
    <!-- 통합 추적 초기화 -->
    <script>
        window.dataLayer = window.dataLayer || [];
        window.__GA_MEASUREMENT_ID__ = 'G-DE2ZNKWV2W';
        window.__GTM_ID__ = 'GTM-594SVWKB';
        console.log('[TRACKING] 🚀 Starting enhanced tracking test');
    </script>
    
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-594SVWKB');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Google Analytics 4 - 강화된 추적 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DE2ZNKWV2W"></script>
    <script>
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        
        gtag('config', 'G-DE2ZNKWV2W', { 
            send_page_view: true,
            transport_type: 'beacon',
            allow_enhanced_conversions: true,
            anonymize_ip: false,
            allow_google_signals: true,
            debug_mode: true,
            dev_id: 'dZTNiMT'
        });
        
        // 즉시 페이지뷰 전송
        gtag('event', 'page_view', {
            page_title: document.title,
            page_location: window.location.href,
            page_path: window.location.pathname
        });
        
        console.log('[GA4] ✅ Enhanced GA4 initialized');
    </script>
    
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .test-button { background: #4285f4; color: white; border: none; padding: 15px 30px; 
                      font-size: 16px; border-radius: 5px; cursor: pointer; margin: 10px; 
                      display: block; width: 300px; }
        .test-button:hover { background: #3367d6; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; background: #f0f0f0; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        #console-output { background: #000; color: #00ff00; padding: 15px; font-family: monospace; 
                         height: 300px; overflow-y: auto; white-space: pre-wrap; }
    </style>
</head>
<body>
    <!-- GTM noscript -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-594SVWKB"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <h1>🧪 GA4 데이터 수집 테스트</h1>
    
    <div class="status" id="status">초기화 중...</div>
    
    <h2>GA4 표준 이벤트 테스트</h2>
    
    <button class="test-button" onclick="sendStandardEvent('click')">
        표준 이벤트: click
    </button>
    
    <button class="test-button" onclick="sendStandardEvent('select_content')">
        표준 이벤트: select_content
    </button>
    
    <button class="test-button" onclick="sendStandardEvent('purchase')">
        표준 이벤트: purchase
    </button>
    
    <button class="test-button" onclick="sendPageView()">
        페이지뷰 재전송
    </button>
    
    <button class="test-button" onclick="checkNetworkRequests()">
        네트워크 요청 확인
    </button>
    
    <h2>실시간 콘솔</h2>
    <div id="console-output"></div>
    
    <h2>✅ 확인 방법</h2>
    <ol>
        <li><strong>GA4 실시간 개요</strong>에서 "활성 사용자" 확인</li>
        <li><strong>이벤트</strong> 섹션에서 실시간 이벤트 확인</li>
        <li><strong>브라우저 Network 탭</strong>에서 google-analytics.com 요청 확인</li>
        <li><strong>GA4 DebugView</strong> 활성화하여 디버그 이벤트 확인</li>
    </ol>
    
    <script>
        // 콘솔 출력 캡처
        const output = document.getElementById('console-output');
        const originalLog = console.log;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `[${timestamp}] ${args.join(' ')}\n`;
            output.scrollTop = output.scrollHeight;
        };
        
        // GA4 표준 이벤트 전송
        function sendStandardEvent(eventName) {
            console.log(`[TEST] Sending standard event: ${eventName}`);
            
            const eventParams = {
                event_category: 'test',
                event_label: `test_${eventName}`,
                value: 1,
                timestamp: Date.now()
            };
            
            if (eventName === 'purchase') {
                eventParams.transaction_id = 'test_' + Date.now();
                eventParams.value = 99.99;
                eventParams.currency = 'USD';
            }
            
            if (eventName === 'select_content') {
                eventParams.content_type = 'button';
                eventParams.item_id = 'test_button';
            }
            
            gtag('event', eventName, eventParams);
            console.log(`[TEST] ✅ ${eventName} event sent with params:`, eventParams);
        }
        
        // 페이지뷰 재전송
        function sendPageView() {
            console.log('[TEST] Sending page view...');
            gtag('event', 'page_view', {
                page_title: document.title,
                page_location: window.location.href,
                page_path: window.location.pathname,
                timestamp: Date.now()
            });
            console.log('[TEST] ✅ Page view sent');
        }
        
        // 네트워크 요청 확인
        function checkNetworkRequests() {
            console.log('[NETWORK] Recent network activity:');
            console.log('[NETWORK] Check your browser Network tab for:');
            console.log('[NETWORK] - google-analytics.com/g/collect requests');
            console.log('[NETWORK] - googletagmanager.com requests');
            
            // 상태 업데이트
            updateStatus();
        }
        
        // 상태 업데이트
        function updateStatus() {
            const statusDiv = document.getElementById('status');
            const hasGtag = typeof gtag === 'function';
            const hasDataLayer = Array.isArray(window.dataLayer);
            const dataLayerEvents = window.dataLayer.length;
            
            statusDiv.innerHTML = `
                <strong>GA4 상태:</strong><br>
                ✅ gtag 함수: ${hasGtag ? 'OK' : 'FAIL'}<br>
                ✅ dataLayer: ${hasDataLayer ? 'OK' : 'FAIL'} (${dataLayerEvents}개 이벤트)<br>
                ✅ 측정 ID: G-DE2ZNKWV2W<br>
                ✅ Debug 모드: 활성화됨
            `;
            statusDiv.className = 'status ' + (hasGtag && hasDataLayer ? 'success' : 'error');
            
            console.log('[STATUS] GA4 Status updated:', {
                gtag: hasGtag,
                dataLayer: hasDataLayer,
                events: dataLayerEvents
            });
        }
        
        // 초기화 확인
        setTimeout(() => {
            updateStatus();
            console.log('[INIT] GA4 test page initialized');
            console.log('[INIT] Please check GA4 Real-time reports now!');
        }, 2000);
        
        // 자동 이벤트 전송 (테스트용)
        setTimeout(() => {
            sendStandardEvent('select_content');
        }, 3000);
    </script>
</body>
</html>